@switch/inline isdbref(u(page))=0,{@tel create(Page Extension <PAGE>)=config(master_room)}
&page u(coi)=locate(config(master_room),Page Extension <PAGE>,TXxi)
@parent u(page)=u(coi)
@set u(page)=WIZARD SAFE !NO_COMMAND

&CMD`REPLY u(page)=$^(?s)(?\:r|reply)(?\: +(.+?))?$:@assert words(setr(list,filterbool(#lambda/isobjid(\%0),get(%#/LASTPAGEDBY))))=@nspemit %#=Nobody's sent you a page.;@assert strlen(%1)=@nspemit %#=What will you reply with?;@force/inline/clearregs/localize %#={page %q<list>=%1}
@set u(page)/CMD`REPLY=regexp

&STARTUP u(page)=@command/add reply;@command/alias reply=r;@hook/override/inline reply=u(page),CMD`REPLY;@hook/after page=u(page),FUN`LASTPAGEDBY
&FUN`LASTPAGEDBY u(page)=if(words(setr(list,iter(filterbool(#lambda/isdbref(\%0),if(strmatch(after(%u,%b),*=*),namelist(before(after(%u,%b),=)),get(%#/LASTPAGED))),objid(%i0)))),if(words(setr(recip,filterbool(#lambda/and(hasflag(\%0,CONNECTED),or(hasflag(%#,WIZARD),and(elock(\%0/Page,%#),not(hasflag(\%0,HAVEN))))),%q<list>))),null(iter(%q<recip>,attrib_set(%i0/LASTPAGEDBY,setdiff(setunion(%q<recip>,%:),%i0))))))